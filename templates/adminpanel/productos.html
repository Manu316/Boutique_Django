{% extends "adminpanel/base_admin.html" %}
{% block title %}Productos - Panel Lark{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="mb-0 text-white">Productos</h2>
  <button class="btn btn-pink-rounded" data-bs-toggle="modal" data-bs-target="#modalNuevoProducto">
    Nuevo producto
  </button>
</div>

<div class="admin-card-table p-0">
  <table class="table mb-0 align-middle">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Categoría</th>
        <th class="text-center">Stock</th>
        <th class="text-center">Precio</th>
        <th class="text-center">Imagen</th>
        <th class="text-center" style="width: 110px;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for p in products %}
        <tr>
          <td>{{ p.nombre }}</td>
          <td>{{ p.categoria|default:"Sin categoría" }}</td>
          <td class="text-center">{{ p.stock }}</td>
          <td class="text-center">${{ p.precio }}</td>
          <td class="text-center">
            {% if p.imagen %}
              <img src="{{ p.imagen.url }}" alt="{{ p.nombre }}" style="width:40px; height:40px; object-fit:cover; border-radius:6px;">
            {% else %}
              <span class="text-muted small">Sin imagen</span>
            {% endif %}
          </td>
          <td class="text-center">
            <a href="{% url 'adminpanel:producto_eliminar' p.pk %}"
               class="btn btn-sm btn-link text-pink" title="Eliminar">
              <i class="bi bi-trash"></i>
            </a>
            <a href="{% url 'adminpanel:producto_editar' p.pk %}"
               class="btn btn-sm btn-link text-pink" title="Editar">
              <i class="bi bi-pencil-square"></i>
            </a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6" class="text-center text-muted">No hay productos.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="modal fade" id="modalNuevoProducto" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content admin-modal">
      <div class="modal-body">
        <h5 class="mb-3">Nuevo producto</h5>

        <form method="post" action="{% url 'adminpanel:admin_productos' %}" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form.non_field_errors }}

          <div class="mb-3">
            <label class="form-label" for="{{ form.nombre.id_for_label }}">Nombre</label>
            {{ form.nombre }}
            {{ form.nombre.errors }}
          </div>

          <div class="mb-3">
            <label class="form-label" for="{{ form.categoria.id_for_label }}">Categoría</label>
            {{ form.categoria }}
            {{ form.categoria.errors }}
          </div>

          <div class="mb-3">
            <label class="form-label" for="{{ form.descripcion.id_for_label }}">Descripción</label>
            {{ form.descripcion }}
            {{ form.descripcion.errors }}
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label" for="{{ form.talla.id_for_label }}">Talla</label>
              {{ form.talla }}
              {{ form.talla.errors }}
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label" for="{{ form.color.id_for_label }}">Color</label>
              {{ form.color }}
              {{ form.color.errors }}
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label" for="{{ form.stock.id_for_label }}">Stock</label>
              {{ form.stock }}
              {{ form.stock.errors }}
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label" for="{{ form.precio.id_for_label }}">Precio</label>
              {{ form.precio }}
              {{ form.precio.errors }}
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label" for="{{ form.imagen.id_for_label }}">Imagen</label>
              {{ form.imagen }}
              {{ form.imagen.errors }}
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              Guardar
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}